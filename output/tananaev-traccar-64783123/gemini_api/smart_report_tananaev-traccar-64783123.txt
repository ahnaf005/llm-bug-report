## Bug Report: NullPointerException in CastelProtocolDecoder during Test Execution

### 1. Title
NullPointerException in `CastelProtocolDecoder.decode` when `channel` is null during `MSG_LOGIN` processing.

### 2. Steps to Reproduce
1.  Clone the `tananaev/traccar` repository.
2.  Checkout the specific commit `6883ecf8462e26f63d2709426c2cacf5dd318c49`.
3.  Run the Maven test phase: `mvn test -B`.

### 3. Triggering Input
The bug is triggered when the `decode` method of `CastelProtocolDecoder` is called with a `channel` parameter that is `null`, specifically when processing a message of type `MSG_LOGIN`. This scenario is simulated by the `CastelProtocolDecoderTest.testDecode` unit test.

### 4. Expected Behavior
The `CastelProtocolDecoderTest` should pass without any errors. The `CastelProtocolDecoder.decode` method should correctly handle cases where the `channel` is null, especially when attempting to write a response for a `MSG_LOGIN` message, by not attempting to write to a non-existent channel.

### 5. Observed Behavior
The build fails during the `mvn test -B` phase. The `org.traccar.protocol.CastelProtocolDecoderTest.testDecode` method throws a `java.lang.NullPointerException` at line 95 of `CastelProtocolDecoder.java`. This indicates that an attempt was made to access a method or field on a null object.

**Error Message:**
```
testDecode(org.traccar.protocol.CastelProtocolDecoderTest)  Time elapsed: 0.005 sec  <<< ERROR!
java.lang.NullPointerException
	at org.traccar.protocol.CastelProtocolDecoder.decode(CastelProtocolDecoder.java:95)
	at org.traccar.protocol.CastelProtocolDecoderTest.testDecode(CastelProtocolDecoderTest.java:20)
    ... (rest of stack trace)
```

### 6. Relevant Code Snippets
The issue is in `src/org/traccar/protocol/CastelProtocolDecoder.java` within the `decode` method, specifically in the block handling `MSG_LOGIN`:

```java
// src/org/traccar/protocol/CastelProtocolDecoder.java
@@ -80,7 +80,7 @@ public class CastelProtocolDecoder extends BaseProtocolDecoder {
                 return null;
             } else if (type == MSG_LOGIN) {
 
-                if (channel == null) {
+                if (channel != null) {
                     ChannelBuffer response = ChannelBuffers.directBuffer(ByteOrder.LITTLE_ENDIAN, 41);
                     response.writeByte(0x40); response.writeByte(0x40);
                     response.writeShort(response.capacity());
```
The original code (before the patch) had `if (channel == null)`, which meant the code to create and write a `ChannelBuffer` response would *only* execute if the `channel` was null. This would then lead to a `NullPointerException` when `channel.write()` was called on a null `channel` object.

### 7. Stack Traces
```
Running org.traccar.protocol.CastelProtocolDecoderTest
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.005 sec <<< FAILURE!
testDecode(org.traccar.protocol.CastelProtocolDecoderTest)  Time elapsed: 0.005 sec  <<< ERROR!
java.lang.NullPointerException
	at org.traccar.protocol.CastelProtocolDecoder.decode(CastelProtocolDecoder.java:95)
	at org.traccar.protocol.CastelProtocolDecoderTest.testDecode(CastelProtocolDecoderTest.java:20)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:252)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189)
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165)
	at org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75)
```

### 8. Patches / Suggested Fixes
The provided code diff contains the fix for this issue. The condition `if (channel == null)` should be changed to `if (channel != null)` to ensure that the response is only written when a valid channel exists.

```diff
--- a/src/org/traccar/protocol/CastelProtocolDecoder.java
+++ b/src/org/traccar/protocol/CastelProtocolDecoder.java
@@ -80,7 +80,7 @@ public class CastelProtocolDecoder extends BaseProtocolDecoder {
                 return null;
             } else if (type == MSG_LOGIN) {
 
-                if (channel == null) {
+                if (channel != null) {
                     ChannelBuffer response = ChannelBuffers.directBuffer(ByteOrder.LITTLE_ENDIAN, 41);
                     response.writeByte(0x40); response.writeByte(0x40);
                     response.writeShort(response.capacity());
```